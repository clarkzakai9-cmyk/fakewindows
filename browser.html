<!-- Epic Mini Browser -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Epic Mini Browser</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #1e1e1e;
      color: #f0f0f0;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    #main { flex: 1; display: flex; flex-direction: column; }

    /* Edge-style tab bar */
    .tab-bar {
      display: flex;
      overflow-x: auto;
      background: #111;
      padding: 6px 10px;
      box-shadow: inset 0 -1px 0 rgba(255,255,255,0.1);
    }
    .tab {
      background: #2a2a2a;
      color: #eee;
      padding: 6px 14px;
      border-radius: 12px 12px 0 0;
      margin-right: 6px;
      cursor: pointer;
      white-space: nowrap;
      display: flex;
      align-items: center;
      transition: background 0.2s, color 0.2s;
    }
    .tab.active { background: #e81123; color: #fff; box-shadow: 0 -2px 6px rgba(0,0,0,0.4); }
    .tab:hover:not(.active) { background: #444; }
    .close-btn { margin-left: 8px; cursor: pointer; color: #ccc; font-size: 12px; }
    .close-btn:hover { color: #fff; }

    .new-tab-button {
      font-size: 20px;
      padding: 0 12px;
      background: #222;
      color: #fff;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: background 0.2s;
    }
    .new-tab-button:hover { background: #e81123; }

    /* Edge-style URL bar */
    .url-bar {
      display: flex;
      gap: 8px;
      padding: 8px 12px;
      background: #1c1c1c;
      align-items: center;
      box-shadow: inset 0 -1px 0 rgba(255,255,255,0.1);
    }
    .url-bar input {
      flex: 1;
      font-size: 14px;
      padding: 8px 14px;
      border: none;
      border-radius: 20px;
      background: #2a2a2a;
      color: #f0f0f0;
      outline: none;
      transition: background 0.2s;
    }
    .url-bar input:focus { background: #333; box-shadow: 0 0 0 2px #e81123; }
    .url-bar button {
      background: #2a2a2a;
      color: #fff;
      border: none;
      border-radius: 20px;
      padding: 8px 14px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .url-bar button:hover { background: #e81123; }

    /* Viewers */
    #viewer, #offlineFrame {
      flex: 1;
      border: none;
      background: white;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
    }
    #offlineFrame { display: none; background: #000; }
  </style>
</head>
<body>
  <div id="main">
    <div class="tab-bar" id="tabBar"></div>
    <div class="url-bar">
      <input id="urlInput" placeholder="Search or enter web address" />
      <button onclick="goToUrl()">Enter</button>
      <button onclick="reloadTab()">üîÑÔ∏è</button>
      <input type="file" id="fileInput" accept=".html,.htm" style="display:none" />
    </div>

    <!-- Online viewer -->
    <iframe id="viewer"></iframe>

    <!-- Offline viewer -->
    <iframe id="offlineFrame"></iframe>
  </div>

  <script>
    let tabs = [];
    let currentTab = null;

    // Offline page content
    const OFFLINE_HTML = `
      <style>
        body { margin:0; background:#000; color:#fff; font-family:Segoe UI, sans-serif;
               display:flex; align-items:center; justify-content:center; height:100vh; }
        h1 { color:#e81123; }
      </style>
      <div>
        <h1>Offline Mode</h1>
        <p>You‚Äôre offline. Reconnect to browse the web.</p>
      </div>
    `;

    function createNewTab(url="new-tab.html", label="New Tab") {
      const newTab = { label, url, history: [] };
      tabs.push(newTab);
      currentTab = newTab;
      updateTabs();
      openTab(newTab);
      saveTabs();
    }

    function closeTab(e, index) {
      e.stopPropagation();
      tabs.splice(index, 1);
      if (tabs.length === 0) createNewTab();
      else {
        currentTab = tabs[Math.max(index - 1, 0)];
        updateTabs();
        openTab(currentTab);
      }
      saveTabs();
    }

    function updateTabs() {
      const bar = document.getElementById("tabBar");
      bar.innerHTML = "";
      tabs.forEach((tab, i) => {
        const div = document.createElement("div");
        div.className = "tab" + (tab === currentTab ? " active" : "");
        div.innerHTML = `${tab.label} <span class="close-btn" onclick="closeTab(event, ${i})">‚ùå</span>`;
        div.onclick = e => {
          if (!e.target.classList.contains("close-btn")) {
            currentTab = tab;
            updateTabs();
            openTab(tab);
          }
        };
        bar.appendChild(div);
      });
      const btn = document.createElement("button");
      btn.className = "new-tab-button";
      btn.textContent = "Ôºã";
      btn.onclick = () => createNewTab();
      bar.appendChild(btn);
    }

    function openTab(tab) {
      currentTab = tab;
      document.getElementById("viewer").src = tab.url;
      document.getElementById("urlInput").value = tab.url;
      tab.history.push(tab.url);
      saveTabs();
      updateConnectionStatus();
    }

    function goToUrl() {
      let url = document.getElementById("urlInput").value.trim();
      if (!url) return;

      // If offline, show offline iframe instead of trying to load
      if (!navigator.onLine) {
        updateConnectionStatus();
        return;
      }

      if (!url.startsWith("http")) url = "https://" + url;
      currentTab.url = url;
      currentTab.label = "üåê " + new URL(url).hostname;
      openTab(currentTab);
    }

    function reloadTab() {
      if (currentTab && currentTab.url) {
        document.getElementById("viewer").src = currentTab.url;
      }
    }

    // Press Enter in URL bar
    document.getElementById("urlInput").addEventListener("keydown", e => {
      if (e.key === "Enter") goToUrl();
    });

    // Open local file
    document.getElementById("fileInput").addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (file && file.name.endsWith(".html")) {
        const reader = new FileReader();
        reader.onload = function (evt) {
          const blob = new Blob([evt.target.result], { type: "text/html" });
          const url = URL.createObjectURL(blob);
          const tab = { label: file.name, url, history: [] };
          tabs.push(tab);
          currentTab = tab;
          updateTabs();
          openTab(tab);
        };
        reader.readAsText(file);
      }
    });

    // Keyboard shortcuts
    document.addEventListener("keydown", function (e) {
      if (e.ctrlKey && e.key.toLowerCase() === "o") {
        e.preventDefault();
        document.getElementById("fileInput").click();
      }
      if (e.ctrlKey && e.key.toLowerCase() === "t") {
        e.preventDefault();
        createNewTab();
      }
    });

    function saveTabs() {
      const data = tabs.map(t => ({ label: t.label, url: t.url }));
      localStorage.setItem("epicTabs", JSON.stringify(data));
    }

    function loadTabs() {
      try {
        const saved = JSON.parse(localStorage.getItem("epicTabs") || "[]");
        saved.forEach(({ label, url }) => {
          tabs.push({ label, url, history: [] });
        });
      } catch {}
    }

    window.addEventListener("beforeunload", saveTabs);

    // --- Offline handling ---
    function updateConnectionStatus() {
      const viewer = document.getElementById("viewer");
      const offlineFrame = document.getElementById("offlineFrame");

      // Always keep offline view ready via srcdoc
      if (!offlineFrame.srcdoc) offlineFrame.srcdoc = OFFLINE_HTML;

      if (navigator.onLine) {
        viewer.style.display = "block";
        offlineFrame.style.display = "none";
      } else {
        viewer.style.display = "none";
        offlineFrame.style.display = "block";
      }
    }

    window.addEventListener("online", updateConnectionStatus);
    window.addEventListener("offline", updateConnectionStatus);

    // Initial setup
    loadTabs();
    if (!tabs.length) {
      createNewTab();
    } else {
      currentTab = tabs[0];
      updateTabs();
      openTab(currentTab);
    }

    // Run connection check once at startup
    updateConnectionStatus();
  </script>
</body>
</html>
